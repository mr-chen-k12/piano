<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>üçÅ Fall Piano Note Trainer</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

<style>
  :root {
    --bg-gradient: linear-gradient(to bottom right, #fff7e6, #ffe5b4);
    --card-gradient: linear-gradient(to bottom right, #fff2cc, #ffd59e);
    --text: #6b3e1d;
    --button-bg: #ffb347;
    --button-hover: #ffcc33;
    --button-text: #5b2c00;
    --border: #d69e2e;
  }
  body.fall-dark {
    --bg-gradient: linear-gradient(to bottom right, #3a1f04, #5b3a0c);
    --card-gradient: linear-gradient(to bottom right, #5b3a0c, #7a5112);
    --text: #ffe9a1;
    --button-bg: #d97706;
    --button-hover: #fbbf24;
    --button-text: #fff8dc;
    --border: #fbbf24;
  }

  body {
    font-family: "Fredoka One", cursive;
    background: var(--bg-gradient);
    color: var(--text);
    transition: all 0.4s ease;
    overflow-x: hidden;
  }

  #noteCanvas {
    background: var(--card-gradient);
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(107, 46, 9, 0.25);
    transition: all 0.4s;
  }

  .note-btn {
    border: 3px solid var(--border);
    background: var(--button-bg);
    color: var(--button-text);
    font-weight: 700;
    border-radius: 50%;
    transition: all 0.15s ease;
    box-shadow: 3px 5px 8px rgba(0,0,0,0.15);
  }

  .note-btn:hover {
    background: var(--button-hover);
    transform: scale(1.05);
  }

  .toggle-btn {
    border: 2px solid var(--border);
    background: var(--button-bg);
    color: var(--button-text);
    font-size: 1rem;
    padding: 8px 14px;
    border-radius: 10px;
    margin: 0 6px;
    transition: all 0.2s;
    box-shadow: 2px 3px 6px rgba(0,0,0,0.1);
  }

  .toggle-btn:hover {
    background: var(--button-hover);
    transform: scale(1.05);
  }

  #progress-bar {
    position: relative;
    width: 90%;
    height: 10px;
    background: linear-gradient(to right, #fcd34d, #f97316);
    border-radius: 5px;
    margin: 0 auto 10px auto;
  }

  #progress-pointer {
    position: absolute;
    top: -14px;
    width: 0;
    height: 0;
    border-left: 8px solid transparent;
    border-right: 8px solid transparent;
    border-top: 14px solid #6b3e1d;
    transition: left 0.4s ease-out;
    transform: translateX(-50%);
  }

  #feedback {
    min-height: 1.8em;
    line-height: 1.8em;
    font-size: 1.3rem;
    font-weight: bold;
    transition: opacity 0.3s ease;
  }

  /* ======== Responsive Design ======== */
  @media (max-width: 768px) {
    main {
      padding: 10px !important;
    }

    #noteCanvas {
      width: 300px !important;
      height: 180px !important;
    }

    .note-btn {
      width: 50px !important;
      height: 50px !important;
      font-size: 1.1rem !important;
    }

    h1 {
      font-size: 1.8rem !important;
    }

    p, span, button, #feedback {
      font-size: 1rem !important;
    }

    .flex.items-center.justify-between.w-full.px-4 {
      flex-direction: row;
      justify-content: space-around;
      gap: 10px;
    }

    .flex.flex-col.gap-4 {
      gap: 10px !important;
    }

    #progress-bar {
      width: 95%;
    }
  }
</style>
</head>

<body class="min-h-screen flex flex-col items-center justify-center p-4">
<main class="rounded-2xl shadow-xl w-full max-w-5xl text-center border-4 p-6 flex flex-col items-center"
      style="background:var(--card-gradient); border-color:var(--border);">

  <h1 class="text-4xl font-extrabold mb-1">üçÇ Piano Note Fun!</h1>
  <p class="text-lg mb-3 opacity-90">Tap or press A‚ÄìG to guess the note üéπ</p>

  <!-- Score bar -->
  <div class="w-full mb-4">
    <div id="progress-bar">
      <div id="progress-pointer"></div>
    </div>
    <div class="flex justify-between text-sm font-bold opacity-70">
      <span>Nice Try</span><span>Good Work</span><span>Pro!</span>
    </div>
  </div>

  <div class="flex justify-center mb-3 text-lg font-semibold">
    <span class="mr-6">üî• Streak: <span id="streak-el">0</span></span>
    <span>‚≠ê Accuracy: <span id="percent-el">0%</span></span>
  </div>

  <!-- Main game area -->
  <div class="flex items-center justify-between w-full px-4">
    <div class="flex flex-col gap-4">
      <button class="note-btn">A</button>
      <button class="note-btn">B</button>
      <button class="note-btn">C</button>
    </div>

    <div class="flex justify-center">
      <canvas id="noteCanvas" width="500" height="280"></canvas>
    </div>

    <div class="flex flex-col gap-4">
      <button class="note-btn">D</button>
      <button class="note-btn">E</button>
      <button class="note-btn">F</button>
      <button class="note-btn">G</button>
    </div>
  </div>

  <p id="feedback" class="mt-3 opacity-80">...</p>

  <div class="mt-6 flex justify-center flex-wrap gap-4">
    <button id="theme-toggle" class="toggle-btn">üåû Light Theme</button>
    <button id="move-toggle" class="toggle-btn">üéØ Move Notes</button>
  </div>

  <p class="text-xs mt-3 opacity-80">Range: C4 (below) ‚Üí A5 (above)</p>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const canvas = document.getElementById('noteCanvas');
  const ctx = canvas.getContext('2d');
  const feedback = document.getElementById('feedback');

  // Detect mobile to adjust internal spacing
  const isMobile = window.innerWidth < 768;
  const left = isMobile ? 50 : 80;
  const right = isMobile ? canvas.width - 30 : canvas.width - 40;
  const staffTop = isMobile ? 60 : 100;
  const spacing = isMobile ? 14 : 22;
  const lineYs = Array.from({length:5}, (_,i)=> staffTop + i*spacing);
  const yE4 = lineYs[4];
  const STEP = spacing/2;

  const allNotes = ['C4','D4','E4','F4','G4','A4','B4','C5','D5','E5','F5','G5','A5'];
  let currentNote = 'E4', currentIndex = allNotes.indexOf(currentNote);
  let streak = 0, total = 0, correct = 0, score = 0;
  let moveX = false;

  function drawStaff() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.lineWidth = isMobile ? 2 : 3;
    lineYs.forEach(y => {
      ctx.beginPath();
      ctx.moveTo(left, y);
      ctx.lineTo(right, y);
      ctx.stroke();
    });
  }

  function yFromStep(step) { return yE4 + step*STEP; }

  function stepFromNote(note) {
    const map = {
      'C4': +2,'D4': +1,'E4': 0,'F4': -1,'G4': -2,'A4': -3,'B4': -4,
      'C5': -5,'D5': -6,'E5': -7,'F5': -8,'G5': -9,'A5': -10
    };
    return map[note];
  }

  function drawLedgerIfNeeded(step, x) {
    const color = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.strokeStyle = color;
    ctx.lineWidth = isMobile ? 2 : 3;
    if (step >= +2) { const y = yFromStep(+2); ctx.beginPath(); ctx.moveTo(x - 20, y); ctx.lineTo(x + 20, y); ctx.stroke(); }
    if (step <= -10){ const y = yFromStep(-10); ctx.beginPath(); ctx.moveTo(x - 40, y); ctx.lineTo(x + 40, y); ctx.stroke(); }
  }

  function drawNote(note) {
    const step = stepFromNote(note);
    const y = yFromStep(step);
    const baseX = canvas.width / 2;
    const x = moveX ? baseX + (Math.random() * (isMobile ? 60 : 100) - (isMobile ? 30 : 50)) : baseX;

    drawStaff();
    drawLedgerIfNeeded(step, x);

    const color = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    ctx.lineWidth = isMobile ? 2 : 3;

    const noteW = isMobile ? 10 : 16;
    const noteH = isMobile ? 8 : 12;
    ctx.beginPath();
    ctx.ellipse(x, y, noteW, noteH, -0.25, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    const upStem = (step >= -4);
    const stemLen = isMobile ? 30 : 48;
    ctx.beginPath();
    if (upStem) { ctx.moveTo(x+noteW-2, y-2); ctx.lineTo(x+noteW-2, y-stemLen); }
    else { ctx.moveTo(x-noteW+2, y+2); ctx.lineTo(x-noteW+2, y+stemLen); }
    ctx.stroke();
  }

  function pickNewNote() {
    const stepChange = (Math.random() > 0.5 ? 1 : -1);
    const moveDistance = Math.min(3, Math.floor(streak / 3) + 1);
    const nextIndex = Math.max(0, Math.min(allNotes.length-1, currentIndex + stepChange * moveDistance));
    currentIndex = nextIndex;
    currentNote = allNotes[currentIndex];
    drawNote(currentNote);
    feedback.textContent = '...';
    feedback.style.opacity = '0.6';
  }

  function updateProgressBar() {
    const progress = Math.min(score, 50);
    const pct = (progress / 50) * 100;
    document.getElementById('progress-pointer').style.left = `${pct}%`;
  }

  function updateHUD() {
    document.getElementById('streak-el').textContent = streak;
    const pct = total ? Math.round((correct/total)*100) : 0;
    document.getElementById('percent-el').textContent = pct + '%';
    updateProgressBar();
  }

  function showFeedback(msg, color) {
    feedback.textContent = msg;
    feedback.style.color = color;
    feedback.style.opacity = '1';
  }

  function handleGuess(k) {
    if (!'ABCDEFG'.includes(k)) return;
    total++;
    const answer = currentNote[0];
    if (k === answer) {
      streak++; correct++; score = Math.min(50, score + 1);
      showFeedback('üéâ Yay! Correct!', '#ff7f00');
    } else {
      streak = 0;
      showFeedback(`üòÖ It was ${answer}`, '#b91c1c');
      score = Math.max(0, score - 1);
    }
    updateHUD();
    setTimeout(pickNewNote, 900);
  }

  document.addEventListener('keydown', e => handleGuess(e.key.toUpperCase()));
  document.querySelectorAll('.note-btn').forEach(btn =>
    btn.addEventListener('click', () => handleGuess(btn.textContent))
  );

  document.getElementById('theme-toggle').addEventListener('click', () => {
    document.body.classList.toggle('fall-dark');
    const btn = document.getElementById('theme-toggle');
    btn.textContent = document.body.classList.contains('fall-dark') ? '‚òÄÔ∏è Light Theme' : 'üåô Cozy Dark';
    drawNote(currentNote);
  });

  document.getElementById('move-toggle').addEventListener('click', () => {
    moveX = !moveX;
    const btn = document.getElementById('move-toggle');
    btn.textContent = moveX ? 'üéØ Fixed Notes' : 'üéØ Move Notes';
    drawNote(currentNote);
  });

  drawStaff();
  drawNote(currentNote);
  updateHUD();
});
</script>
</body>
</html>
