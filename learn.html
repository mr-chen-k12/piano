<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>🍁 Fall Piano Note Trainer</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-gradient: linear-gradient(to bottom right, #fff7e6, #ffe5b4);
    --card-gradient: linear-gradient(to bottom right, #fff2cc, #ffd59e);
    --text: #6b3e1d;
    --button-bg: #ffb347;
    --button-hover: #ffcc33;
    --button-text: #5b2c00;
    --border: #d69e2e;
  }
  body.fall-dark {
    --bg-gradient: linear-gradient(to bottom right, #3a1f04, #5b3a0c);
    --card-gradient: linear-gradient(to bottom right, #5b3a0c, #7a5112);
    --text: #ffe9a1;
    --button-bg: #d97706;
    --button-hover: #fbbf24;
    --button-text: #fff8dc;
    --border: #fbbf24;
  }

  body {
    font-family: "Fredoka One", cursive;
    background: var(--bg-gradient);
    color: var(--text);
    transition: all 0.4s ease;
  }

  #noteCanvas {
    background: var(--card-gradient);
    border-radius: 16px;
    box-shadow: 0 8px 20px rgba(107, 46, 9, 0.2);
    transition: background 0.4s;
  }

  .note-btn {
    border: 3px solid var(--border);
    background: var(--button-bg);
    color: var(--button-text);
    font-weight: 700;
    border-radius: 50%;
    width: 70px;
    height: 70px;
    font-size: 1.5rem;
    transition: all 0.15s ease;
    box-shadow: 3px 5px 8px rgba(0,0,0,0.15);
  }
  .note-btn:hover {
    background: var(--button-hover);
    transform: scale(1.05);
  }

  .toggle-btn {
    border: 2px solid var(--border);
    background: var(--button-bg);
    color: var(--button-text);
    font-size: 1rem;
    padding: 8px 14px;
    border-radius: 10px;
    margin: 0 6px;
    transition: all 0.2s;
    box-shadow: 2px 3px 6px rgba(0,0,0,0.1);
  }
  .toggle-btn:hover {
    background: var(--button-hover);
    transform: scale(1.05);
  }

  #feedback { height: 1.5em; }
</style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

<main class="rounded-2xl shadow-xl w-full max-w-5xl text-center border-4 p-6 flex flex-col items-center" style="background:var(--card-gradient); border-color:var(--border);">
  <h1 class="text-4xl font-extrabold mb-1">🍂 Piano Note Fun!</h1>
  <p class="text-lg mb-4 opacity-90">Tap or press A–G to guess the note 🎹</p>

  <div class="flex justify-center mb-3 text-lg font-semibold">
    <span class="mr-6">🔥 Streak: <span id="streak-el" class="font-bold">0</span></span>
    <span>⭐ Accuracy: <span id="percent-el" class="font-bold">0%</span></span>
  </div>

  <!-- Wider layout for thumb reach -->
  <div class="flex items-center justify-between w-full px-4">
    <!-- Left buttons -->
    <div class="flex flex-col gap-4">
      <button class="note-btn">A</button>
      <button class="note-btn">B</button>
      <button class="note-btn">C</button>
    </div>

    <!-- Canvas -->
    <div class="flex justify-center">
      <canvas id="noteCanvas" width="500" height="280"></canvas>
    </div>

    <!-- Right buttons -->
    <div class="flex flex-col gap-4">
      <button class="note-btn">D</button>
      <button class="note-btn">E</button>
      <button class="note-btn">F</button>
      <button class="note-btn">G</button>
    </div>
  </div>

  <p id="feedback" class="mt-3 text-xl font-bold"></p>

  <div class="mt-6 flex justify-center flex-wrap gap-4">
    <button id="theme-toggle" class="toggle-btn">🌞 Light Theme</button>
    <button id="move-toggle" class="toggle-btn">🎯 Move Notes</button>
  </div>

  <p class="text-xs mt-3 opacity-80">Range: C4 (below) → A5 (above)</p>
</main>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const canvas = document.getElementById('noteCanvas');
  const ctx = canvas.getContext('2d');
  const left = 80, right = canvas.width - 40;
  const staffTop = 100, spacing = 22; // wider spacing for easier reading
  const lineYs = Array.from({length:5}, (_,i)=> staffTop + i*spacing);
  const yE4 = lineYs[4];
  const STEP = spacing/2;

  const stepsFromE4 = {
    'C4': +2, 'D4': +1,
    'E4': 0,  'F4': -1, 'G4': -2, 'A4': -3, 'B4': -4,
    'C5': -5, 'D5': -6, 'E5': -7, 'F5': -8, 'G5': -9, 'A5': -10
  };

  const notePool = Object.keys(stepsFromE4);
  let currentNote = null, streak = 0, total = 0, correct = 0;
  let moveX = false;

  function drawStaff() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.strokeStyle = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.lineWidth = 3;
    lineYs.forEach(y => {
      ctx.beginPath();
      ctx.moveTo(left, y);
      ctx.lineTo(right, y);
      ctx.stroke();
    });
  }

  function yFromStep(step) { return yE4 + step*STEP; }

  function drawLedgerIfNeeded(step, x) {
    const color = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.strokeStyle = color;
    ctx.lineWidth = 3;
    if (step >= +2) { // Low C4
      const y = yFromStep(+2);
      ctx.beginPath();
      ctx.moveTo(x - 30, y);
      ctx.lineTo(x + 30, y);
      ctx.stroke();
    }
    if (step <= -10) { // High A5
      const y = yFromStep(-10);
      ctx.beginPath();
      ctx.moveTo(x - 60, y);
      ctx.lineTo(x + 60, y);
      ctx.stroke();
    }
  }

  function drawNote(noteName) {
    const step = stepsFromE4[noteName];
    const y = yFromStep(step);
    const baseX = canvas.width / 2;
    const x = moveX ? baseX + (Math.random() * 100 - 50) : baseX;

    drawStaff();
    drawLedgerIfNeeded(step, x);

    const color = getComputedStyle(document.body).getPropertyValue('--text');
    ctx.fillStyle = color;
    ctx.strokeStyle = color;
    ctx.lineWidth = 3;

    // larger notehead
    ctx.beginPath();
    ctx.ellipse(x, y, 16, 12, -0.25, 0, Math.PI*2);
    ctx.fill();
    ctx.stroke();

    // longer stem
    const upStem = (step >= -4);
    const stemLen = 48;
    ctx.beginPath();
    if (upStem) {
      ctx.moveTo(x+14, y-2);
      ctx.lineTo(x+14, y-stemLen);
    } else {
      ctx.moveTo(x-14, y+2);
      ctx.lineTo(x-14, y+stemLen);
    }
    ctx.stroke();
  }

  function pickNewNote() {
    currentNote = notePool[Math.floor(Math.random()*notePool.length)];
    drawNote(currentNote);
    document.getElementById('feedback').textContent = '';
  }

  function updateHUD() {
    document.getElementById('streak-el').textContent = streak;
    document.getElementById('percent-el').textContent =
      total ? Math.round((correct/total)*100)+'%' : '0%';
  }

  function handleGuess(k) {
    if (!'ABCDEFG'.includes(k)) return;
    total++;
    const answer = currentNote[0];
    const fb = document.getElementById('feedback');
    if (k === answer) {
      streak++; correct++;
      fb.textContent = '🎉 Yay! Correct!';
      fb.style.color = '#ff7f00';
    } else {
      streak = 0;
      fb.textContent = `😅 It was ${answer}`;
      fb.style.color = '#b91c1c';
    }
    updateHUD();
    setTimeout(pickNewNote, 900);
  }

  document.addEventListener('keydown', e => handleGuess(e.key.toUpperCase()));
  document.querySelectorAll('.note-btn').forEach(btn =>
    btn.addEventListener('click', () => handleGuess(btn.textContent))
  );

  document.getElementById('theme-toggle').addEventListener('click', () => {
    document.body.classList.toggle('fall-dark');
    const btn = document.getElementById('theme-toggle');
    btn.textContent = document.body.classList.contains('fall-dark') ? '☀️ Light Theme' : '🌙 Cozy Dark';
    drawNote(currentNote);
  });

  document.getElementById('move-toggle').addEventListener('click', () => {
    moveX = !moveX;
    const btn = document.getElementById('move-toggle');
    btn.textContent = moveX ? '🎯 Fixed Notes' : '🎯 Move Notes';
    drawNote(currentNote);
  });

  drawStaff();
  pickNewNote();
  updateHUD();
});
</script>
</body>
</html>
